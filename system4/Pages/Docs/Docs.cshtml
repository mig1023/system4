@page "/docs/{type}/{pageNum?}"
@model system4.Pages.Docs.DocsModel
@{
    ViewData["Title"] = "Docs";
}

<div class="text-center">
    <h1 class="display-4">Договоры</h1>

    <form method="post">
        <div class="input-group padding_search">

            <input type="search" asp-for="Search" class="form-control rounded"
                placeholder="01.000001.010125 или 01.01.2025, или 123456789, или 2025/00000001"
                aria-label="Search" aria-describedby="search-addon" value="@Model.Search" />

            <button type="submit" class="btn btn-outline-primary padding_search_buttons"
                    data-mdb-ripple-init name="doSearch">
                искать
            </button>

            @if (!String.IsNullOrEmpty(Model.Search))
            {
                <button type="submit" class="btn btn-danger padding_search_buttons"
                        data-mdb-ripple-init name="doClean">
                    сбросить
                </button>
            }
        </div>
    </form>

    <table class="table table_vertical_center">
        <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">Дата договора</th>
                @if (Model.Companies)
                {
                    <th scope="col">Организация</th>
                }
                else
                {
                    <th scope="col">Заказчик</th>
                    <th scope="col">Номер паспорта</th>
                }
                <th scope="col">Тип визы</th>
                <th scope="col">Визовый центр</th>
                <th scope="col">Доп.инфо</th>
                <th scope="col">Кол-во виз</th>
                <th scope="col">Статус</th>
            </tr>
        </thead>
        <tbody>
            @{
                if (Model.DocPack.Count > 0)
                {
                    foreach (DAL.DocPack doc in Model.DocPack)
                    {
                        <tr>
                            <td><a class="normal-link" href="/doc/@Model.LinkType/@doc.Id/">@DAL.Formats.Agreement(doc.AgreementNo)</a></td>
                            <td>@doc.PDate.Date.ToString("dd.MM.yyyy")</td>
                            @if (Model.Companies)
                            {
                                <td>@doc.PassNum</td>
                            }
                            else
                            {
                                <td>@doc.LName @doc.FName @doc.MName</td>
                                <td>@doc.PassNum</td>
                            }
                            <td>@doc.Visa.VName</td>
                            <td>@doc.Center.BName</td>
                            <td class="comment_text table_additional_info">
                                @if (doc.Shipping > 0)
                                {
                                    <div><b>доставка</b></div>
                                }
                                @if (doc.Urgent > 0)
                                {
                                    <div><b>срочная</b></div>
                                }
                                @if (doc.SMS > 0)
                                {
                                    <div><b>SMS</b></div>
                                }
                            </td>
                            <td>@doc.Applicants.Where(x => x.Status != 7).Count()</td>
                            <td>@DAL.Constants.DocStatuses(doc.PStatus)</td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="9"><i>Список пуст, договоров не найдено</i></td>
                    </tr>
                }

            }
        </tbody>
    </table>
</div>

<div class="text-center">
    @{
        if (Model.Current > 1)
        {
            <a class="normal-link" href="/docs/@Model.LinkType/@(Model.Current - 1)/">предыдущая</a>
            <text> -</text>
        }

        for (int i = 1; i <= Model.Pages; i++)
        {
            if (i == Model.Current)
            {
                <b>@i</b>
            }
            else
            {
                <a class="normal-link" href="/docs/@Model.LinkType/@i/">@i</a>
            }

            if (i < Model.Pages)
            {
                <text>-</text>
            }
        }

        if (Model.Current < Model.Pages)
        {
            <text>- </text>
            <a class="normal-link" href="/docs/@Model.LinkType/@(Model.Current + 1)/">следующая</a>
        }
    }
